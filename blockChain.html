<!DOCTYPE html>
<html lang="English">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>区块链学习分享 | VuePress</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/blog/favicon.ico">
    <link  rel="stylesheet" href="/blog/iconfont/iconfont.css"></link >
    <meta name="description" content="Vue-powered Static Site Generator">
    <meta name="keywords" content="jin,jin的博客,jin全栈">
    
    <link rel="preload" href="/blog/assets/css/0.styles.040bae09.css" as="style"><link rel="preload" href="/blog/assets/js/app.ab1abfeb.js" as="script"><link rel="preload" href="/blog/assets/js/3.4135f89c.js" as="script"><link rel="preload" href="/blog/assets/js/1.a0837bf1.js" as="script"><link rel="preload" href="/blog/assets/js/13.c6e7940e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ec4e1261.js"><link rel="prefetch" href="/blog/assets/js/11.eaad886f.js"><link rel="prefetch" href="/blog/assets/js/12.e85ee541.js"><link rel="prefetch" href="/blog/assets/js/14.645f153d.js"><link rel="prefetch" href="/blog/assets/js/15.48347d41.js"><link rel="prefetch" href="/blog/assets/js/16.23a41d22.js"><link rel="prefetch" href="/blog/assets/js/17.5172c243.js"><link rel="prefetch" href="/blog/assets/js/18.da7a9fa3.js"><link rel="prefetch" href="/blog/assets/js/4.ac37c126.js"><link rel="prefetch" href="/blog/assets/js/5.2b11ef47.js"><link rel="prefetch" href="/blog/assets/js/6.8457debb.js"><link rel="prefetch" href="/blog/assets/js/7.113c24a2.js"><link rel="prefetch" href="/blog/assets/js/8.0e4f6819.js"><link rel="prefetch" href="/blog/assets/js/9.146f7a8f.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.040bae09.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="VuePress" class="logo"> <span class="site-name can-hide">VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/test/" class="nav-link">
  news
</a></div><div class="nav-item"><a href="/blog/download/" class="nav-link">
  download
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/blockChain.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/blog/zh/blockChain.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/test/" class="nav-link">
  news
</a></div><div class="nav-item"><a href="/blog/download/" class="nav-link">
  download
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/blockChain.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/blog/zh/blockChain.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="区块链学习分享"><a href="#区块链学习分享" class="header-anchor">#</a> 区块链学习分享</h1> <div class="language- extra-class"><pre class="language-text"><code>目录
第一部分 -- 几种共识方式：PoW, PoS, DPoS, BPoS
第二部分 -- Tendermint
</code></pre></div><h2 id="第一部分-几种共识方式-pow-pos-dpos-bpos"><a href="#第一部分-几种共识方式-pow-pos-dpos-bpos" class="header-anchor">#</a> 第一部分 -- 几种共识方式：PoW, PoS, DPoS, BPoS</h2> <p>共识方式：</p> <p>区块链相比于传统数据库，一个关键的特性就是去中心化。区块链中没有像银行一样的中心化机构，所以在进行传输信息、价值转移时，共识机制能够保证每一笔交易在所有记账节点上的一致性和正确性问题。</p> <h5 id="pow-工作证明-比特币"><a href="#pow-工作证明-比特币" class="header-anchor">#</a> POW（工作证明）- 比特币</h5> <p>Proof of Work，工作量证明。在比特币中它要求矿工进行大量的数学运算，来寻找一个符合要求的随机数，来获取记账权，从而获得比特币的奖励，这就是所谓的挖矿。POW以耗费大量时间、资源为担保，确保记账工作的真实有效性。</p> <ul><li><p>特点：多劳多得的模式。算力越高、挖矿时间越长，获得的数字货币就越多。</p></li> <li><p>优点</p> <ul><li>算法简单，采用大家认可的数学逻辑（找寻随机数），容易实现。而破坏整个系统，需要投入巨大成本，有一定安全保障。</li> <li>去中心化程度高，记账权公平地分配到世界各地。当一个或者几个节点被攻击时，整个区块链系统不会受到影响。</li></ul></li> <li><p>缺点</p> <ul><li>耗费大量的电力用于计算无意义的随机数，造成资源浪费。比如说，一万个矿工同时开始挖矿，当一个矿工找到了谜底，其他矿工的努力都相当于白白浪费了。</li> <li>容易造成分叉，增加了交易的不确定性和延迟性。当多个用户在几秒内同时找到谜底时，链就会产生分支，用户就会看到下个块的多个候选者，而且这些分支可以通过继续添加新块来继续延长。但最终，只有一条最长的链可以存活，其他的分支都会消失。这样就使得交易的不确定性增加，当自己的交易被写进块中时，并不能确认交易已经成功。要有足够多的块连接在自己交易的块之后，才能有较大概率认为交易已经成功。而一个块生成周期大约是10分钟，一般需要6个块的确认，则确认一个交易至少需要60分钟以上。缓慢的速度和不确定性不适合商业应用。</li> <li>如今算力越来越集中，中心化日益严重。比特币区块链中，超过51%的算力被三大矿池（BTC.COM、蚁池和微比特）控制。如果他们被贿赂或联合起来决定作恶，则可以擦除块或者更改块的顺序，因为他们掌握超过51%的算力，有能力在一个作恶的块后链接更多的块，从而成为最长分支，使得其他分支失效。</li></ul></li> <li><p>例子：BTC，LTC等</p></li></ul> <h5 id="pos-权益证明-点点币"><a href="#pos-权益证明-点点币" class="header-anchor">#</a> POS（权益证明）- 点点币</h5> <p>Proof of Stake。每个人持币人根据持有的货币的量和时间来发放利息。一个币一天会产生一个币龄。币龄最大的人拥有记账权，当他出块后，币龄清空，他将获得利息，利息根据总币龄数决定。利息 = 总币龄/365*5%  （假定每清空365个币龄获得0.05个币）。</p> <ul><li><p>特点：</p> <ul><li>不挖矿，依靠币龄决定记账权，利息即奖励，记账后币龄清零。</li> <li>按钱分配，钱生钱</li></ul></li> <li><p>优点：</p> <ul><li>避免挖矿浪费资源。</li> <li>一定程度上避免51%攻击，攻击者需要控制非常多的代币，才有较大概率获得出块权力；而且每次攻击结束后，币龄清零，使得攻击者很难连续出块，攻击者阻止交易进入主链的行为变得十分困难。</li></ul></li> <li><p>缺点：</p> <ul><li>数字货币过于集中化，富者越来越富，散户参与积极性低，基本上拿不到记账权。</li></ul></li> <li><p>例子：点点币，黑币</p></li></ul> <h5 id="dpos-委托权益证明-eos"><a href="#dpos-委托权益证明-eos" class="header-anchor">#</a> DPOS(委托权益证明 ) - EOS</h5> <p>共识：普通持币人投票选择出固定数量（以EOS为例21个）的验证人（超级节点）被授权保护网络。验证人按一个随机产生的顺序轮流出块（验证网络的交易）；不按顺序的区块无效；每过一个周期重新洗牌，打乱原有的顺序。</p> <p>激励：每个出块的验证人将获得奖励。相比于POS，当超级节点出块获得奖励时，会按照参选时承诺的比例发放给他的支持者。</p> <p>治理：当某个超级节点没能旅行职责（轮到他们时没能生成区块），会被除名，网络重新请选投票选出新的超级节点。</p> <ul><li><p>特点：不用挖矿，每年按比例增发代币，超级节点轮流出块，奖励出块的超级节点，该超级节点的支持者按支持的通证（票数）分配奖励。</p></li> <li><p>优点：</p> <ul><li><p>能耗更低。EOS将节点数量进一步减少到21个，在保证网络安全的前提下，整个网络的能耗进一步降低，网络运行成本最低。</p></li> <li><p>更快的确认速度。EOS出块速度为 3 秒，在这里使用了拜占庭容错的方法来完成共识，21个节点需要14个见证人，2/3 以上的见证人确认的交易，就是不可逆的交易了。相比于比特币（PoW机制）产生一个区块需要10分钟，一笔交易完成（6个区块确认后）需要1个小时，效率非常高。</p></li></ul></li> <li><p>缺点：</p> <ul><li>超级节点少，中心化程度高。超级节点若联合起来作恶，将会破坏原社区环境。</li> <li>对于坏节点的处理存在诸多困难。社区选举不能及时有效的阻止一些破坏节点的出现，给网络造成安全隐患。</li></ul></li> <li><p>例子：亿书（101个验证人），EOS（21个验证人）,BTS（101个验证人）</p></li></ul> <h5 id="bpos-质押权益证明-iris"><a href="#bpos-质押权益证明-iris" class="header-anchor">#</a> BPOS(质押权益证明) -  IRIS</h5> <p>BPOS和Dpos其实比较类似，DPOS是投票选出验证人，但验证人之间是平等的，按随机顺序轮流出块。但在BPOS中验证人是不平等的，有排行的。</p> <p>共识：以IRIS为例，验证人固定数量为100，所有的用户都可以申请成为验证人，（持有的token+受委托的token数量）前100的验证人能够参与共识，未入选的成为候选人。关于出块人的选择，对验证人进行一个新的排行， 持有的与受委托的token数量+未出块的次数累计系数值 排行第一的 验证人进行出块。其余的验证人对该块进行投票，来参与网络共识，超过2/3的验证人确认后，该区块便确定下来。普通持币人通过委托的方式将token委托给其他验证人从而参与网络共识。</p> <p>激励：每个参与网络共识的人（包括委托人），根据持有的token数量，按比例获取奖励。另外，委托人获取收益时要扣除一定比例的委托费给验证人。<em>最终获得的奖励将根据持有的token数量分配给验证人和委托人，委托人获取收益时要扣除一定比例的委托费给验证人。参与出块的验证人将额外获得验证交易的手续费。</em></p> <ul><li><p>特点：每次出块时，所有验证人都可以获得奖励，并不是只有出块的验证人获得奖励。同样的所有通过委托参与共识的委托人也可以获得奖励。</p></li> <li><p>优点：</p> <ul><li>一旦某个块被生成了，那就是不可逆的，因为每个块生成时，都经过所有验证人的确认。区别于概率链（比特币，块生成后，需要后续多个块的生成，才有较大概率确认块中的交易）。不可逆链的确认交易的效率更高，更有利于跨链交易。在跨链交易时，比如要将A链的资产转移到B链，那么需要在A链中冻结这部分资产，若确认该资产被冻结需要多个块生成才能确认，则会降低交易的效率。</li></ul></li> <li><p>缺点：相比于pow比特币，更趋向于中心化。</p></li> <li><p>例子：Iris，cosmos</p></li></ul> <h2 id="第二部分-tendermint"><a href="#第二部分-tendermint" class="header-anchor">#</a> 第二部分 -- Tendermint</h2> <h3 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h3> <p>Tendermint 是 IRISnet中实现BPoS共识的一款软件。</p> <p>它主要有两部分构成：tendermint core（区块链共识引擎）和 ABCI（应用程序接口）。</p> <p>Tendermint core 主要是完成区块链共识的部分。ABCI 实际上是负责Tendermint core 和APP的通讯，由Tendermint 发送Request消息，交由APP处理，返回Response消息。</p> <p><img src="Elvis%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E5%88%86%E4%BA%AB2.assets/image-20201207164158535.png" alt="image-20201207164158535"></p> <h3 id="流程介绍"><a href="#流程介绍" class="header-anchor">#</a> 流程介绍</h3> <p>下面是一个完整的区块构建的过程的讲解。</p> <p><img src="https://docs.tendermint.com/master/assets/img/tm-transaction-flow.258ca020.png" alt="tx-flow"></p> <h4 id="_1-交易提交"><a href="#_1-交易提交" class="header-anchor">#</a> 1 交易提交</h4> <p>普通用户需要交易时，设定好交易的内容，还有燃油费（奖励给出块人的费用），预处理后，提交到区块链中，某个节点受到了交易后，首先把它放入Mempool cache（内存池缓存），然后利用ABCI发送一个消息CheckTx，交由ABCI APP去检查收到的交易是否合法，如果不合法，就把它舍弃，若合法，则放入Mempool中，同时将这个交易广播出去，让其他节点也将此交易放入自己的Mempool中。</p> <h4 id="_2-提议者出块"><a href="#_2-提议者出块" class="header-anchor">#</a> 2 提议者出块</h4> <p>根据前面所说的BPoS的方式，根据代币总量（拥有代币+受委托的代币总量最大），前100的成为验证人。在验证人中，根据代币总量+未出块累计系数（初始值为零，每轮增加一定值，出块后清零）排行第1的验证人，拥有提议的权力，我们称这个人为提议人，在Mempool中挑选出一定数量的交易写入块中，一般会根据燃油费来决定写入哪些交易，燃油费越高，出块人收益越多。完成交易的写入后，提议人将该块广播给所有的节点。</p> <h4 id="_3-共识过程"><a href="#_3-共识过程" class="header-anchor">#</a> 3 共识过程</h4> <p>对于每一个验证人，受到提议人的区块后，检测该区块的信息，比如区块高度、上一个区块的哈希值是否匹配等信息，然后都该区块进行投票，将自己的投票结果广播给其他节点，同时也收听其他节点的投票结果。当收到了2/3以上的投票后，会再次进行一轮新的投票。当第二次投票也超过2/3的人通过时，每个验证人都会将执行Block Commit操作，将该块写入到本地的区块链中，于是区块链的高度+1。若在投票时，出现少于2/3的人赞同该区块时，那么该区块会被舍弃，排行第二的验证人成为新的提议人，提出一个新的区块，再按上述方法进行共识。</p> <ul><li><ul><li></li></ul></li></ul> <h4 id="_4-其他-abci-连接"><a href="#_4-其他-abci-连接" class="header-anchor">#</a> 4 其他 ABCI 连接</h4> <p><img src="Elvis%E5%8C%BA%E5%9D%97%E9%93%BE%E5%AD%A6%E4%B9%A0%E5%88%86%E4%BA%AB2.assets/image-20201207173638324.png" alt="image-20201207173638324"></p> <p>ABCI的连接主要有四种，上面已经提到过了前两种，但还有两种没有提到。</p> <p>其中Block Commit操作也涉及到了ABCI APP。会使用ABCI发送几条消息，由APP对数据库进行操作：</p> <ul><li><p>Mempool</p></li> <li><p>Consensus</p> <ul><li>BeginBlock
<ul><li>发出新块的开始信号。消息中包含：块的哈希，块头（高度、时间戳等），还有上一个区块的提交的信息，包括（轮数，验证者列表，哪些验证者签署了上一个区块）。</li></ul></li> <li>[DeliverTx,...]
<ul><li>令APP执行n条交易信息。</li></ul></li> <li>EndBlock
<ul><li>标志新块的结束。包含验证人集合更新信息，共识时间大小等参数。</li></ul></li> <li>Commit
<ul><li>将这些交易更新到APP的数据库中，并返回当前app的merkel树的根的哈希值。</li></ul></li></ul></li> <li><p>Query</p> <ul><li>用户若想对数据库内容进行查询时，不能够直接访问，只能通过Tendermint提供的ABCI接口，进行查询。</li></ul></li> <li><p>Snapshot</p> <ul><li>用于快照节点，或者用于还原。当有新的节点加入区块链时，不必要将过往全部区块链拷贝进来，只需要拷贝最后一个已确认的区块，和当前APP的数据的状态。</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.ab1abfeb.js" defer></script><script src="/blog/assets/js/3.4135f89c.js" defer></script><script src="/blog/assets/js/1.a0837bf1.js" defer></script><script src="/blog/assets/js/13.c6e7940e.js" defer></script>
  </body>
</html>
